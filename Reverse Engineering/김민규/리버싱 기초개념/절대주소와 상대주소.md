# 절대주소 VA & 상대주소 RVA

![](https://images.velog.io/images/kmk9502/post/e040c2cf-3e1d-4a30-96ff-bd19381a86f0/%EC%A0%88%EB%8C%80%EC%A3%BC%EC%86%8C%EC%99%80%20%EC%83%81%EB%8C%80%EC%A3%BC%EC%86%8C%20%EC%84%A4%EB%AA%85.png)

<그림으로 표현한 물리 메모리(VA)와 가상 메모리(RVA)>

## 절대주소(VA) 개념

절대주소 VA는 가상 메모리에서 실제 물리 메모리로 옮겨 졌을 때 프로세스가 위치한 주소를 의미한다. </br>이 주소는 절대 변경되지 않으므로 절대주소라고 한다.

## 상대주소(RVA) 개념

상대주소 RVA는 **가상 메모리**에 위치한 프로세스의 주소를 의미한다. 
- ### 가상 메모리 개념
  - 가상 메모리는 물리 메모리에 올라가기 전에 프로세스들을 알맞게 다듬어 주는 곳이다. 
  - 프로세스를 다듬을 수 있다는 것은 가상 메모리 상의 값들이 유동적으로 변할 수 있다는 의미이다. 
  - 그렇기에 ImageBase라는 기준에 따라 주소가 유동적으로 변할 수 있는 상대주소 RVA를 사용한다. 
  - 상대주소를 사용하기 때문에 exe와 dll의 재배치가 가능하다. 
- ### 가상 메모리의 쓰임새
  - 물리 메모리에 올라갈 프로세스를 적절히 다듬는 작업을 수행
  - 물리 메모리의 프로세스가 가상 메모리의 값에 접근하여 필요한 작업을 수행할 수 있도록 한다.
  - 물리 메모리로 올라갈 프로세스가 존재하며 값의 유동적인 변화가 가능하기 때문에 해커와 프로그래머 등이 원하는 작업을 수행할 수 있다.
    - 예시 : OllyDbg, 메모리 해킹, 메모리 동적 할당, 바이너리 수정 등

## 물리 메모리 프로세스의 가상 메모리 접근

물리 메모리 상의 프로세스는 같은 메모리 상의 프로세스가 아닌 가상 메모리의 값에 접근하여 작업을 수행한다.

- ### WHY?
  - ### 물리 메모리의 특징
    - 물리 메모리에 위치한 프로세스는 연속적으로 메모리를 사용해야 하기 때문에 같은 물리 메모리에 있는 프로세스에서 값을 읽거나 쓸 수 없다.
    - 만일 같은 물리 메모리의 값에 접근하여 작업한다면 처리가 느려지고 복잡해지며 충돌이 일어날 수 있다.
- ### 가상 메모리의 등장
  - 물리 메모리의 문제를 해결하기 위해 **가상주소**, 즉 상대주소의 개념이 등장했다. 물리 메모리는 서로 간섭하지 못하니 가상 메모리를 만들고 가상주소에 있는 값에 접근하여 필요한 작업을 수행하기로 한 것이다.

---
## exe 재배치

exe도 dll과 마찬가지로 재배치가 필요하다. 많은 exe가 빌드될 때 PE를 보면 ImageBase가 기본으로 0x400000인 것을 확인할 수 있다. 이때 가상 메모리에 로드된 프로그램이 기본주소에 로드되려 했지만, 이미 어떤 프로그램이 자리를 차지한 경우 dll과 마찬가지로 다른 비어있는 메모리 주소를 찾아간다. 